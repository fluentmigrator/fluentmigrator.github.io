<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>FAQ | FluentMigrator documentation </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="FAQ | FluentMigrator documentation ">
    <meta name="generator" content="docfx 2.44.0.0">
    
    <link rel="shortcut icon" href="../images/favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../images/logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="faq">


<p>This FAQ will answer most common questions. Please <a href="https://github.com/fluentmigrator/fluentmigrator/issues">open an issue</a> if your question isn't answered here.</p>
<h2 id="why-does-the-migrateexe-tool-say-no-migrations-found">Why does the <code>Migrate.exe</code> tool say <code>No migrations found</code>?</h2>
<p>Possible reasons:</p>
<ul>
<li>Migration class isn't public</li>
<li>Migration class isn't derived from <code>IMigration</code> (or <code>Migration</code>)</li>
<li>Migration class isn't attributed with <code>MigrationAttribute</code></li>
<li>The versions of the <code>Migrate.exe</code> tool (<code>FluentMigrator.Console</code> package) and the <code>FluentMigrator</code> package(s) referenced in your project are different.</li>
</ul>
<h2 id="how-can-i-run-fluentmigratordotnetcli-with-a-net-50-assembly">How can I run FluentMigrator.DotNet.Cli with a .NET 5.0 assembly?</h2>
<p>The FluentMigrator.DotNet.Cli contains an <code>--allowDirtyAssemblies</code> switch that will allow you to load your 5.0 assemblies in a .NET Core 3.1 context.  We're working on .NET 5.0 support.</p>
<h2 id="what-are-the-supported-databases">What are the supported databases?</h2>
<table>
<thead>
<tr>
<th>Database</th>
<th>Identifier</th>
<th>Alternative identifier(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Microsoft SQL Server 2019</td>
<td>SqlServer2016<sup>(1)</sup></td>
<td>SqlServer</td>
</tr>
<tr>
<td>Microsoft SQL Server 2017</td>
<td>SqlServer2016<sup>(2)</sup></td>
<td>SqlServer</td>
</tr>
<tr>
<td>Microsoft SQL Server 2016</td>
<td>SqlServer2016</td>
<td>SqlServer</td>
</tr>
<tr>
<td>Microsoft SQL Server 2014</td>
<td>SqlServer2014</td>
<td>SqlServer</td>
</tr>
<tr>
<td>Microsoft SQL Server 2012</td>
<td>SqlServer2012</td>
<td>SqlServer</td>
</tr>
<tr>
<td>Microsoft SQL Server 2008</td>
<td>SqlServer2008</td>
<td>SqlServer</td>
</tr>
<tr>
<td>Microsoft SQL Server 2005</td>
<td>SqlServer2005</td>
<td>SqlServer</td>
</tr>
<tr>
<td>Microsoft SQL Server 2000</td>
<td>SqlServer2000</td>
<td>SqlServer</td>
</tr>
<tr>
<td><del>Microsoft SQL Server Compact Edition</del><sup>(3)</sup></td>
<td><del>SqlServerCe</del></td>
<td><del>SqlServer</del></td>
</tr>
<tr>
<td>PostgreSQL</td>
<td>Postgres</td>
<td>PostgreSQL</td>
</tr>
<tr>
<td>PostgreSQL 9.2</td>
<td>Postgres92</td>
<td>PostgreSQL92</td>
</tr>
<tr>
<td>PostgreSQL 10.0</td>
<td>PostgreSQL10_0</td>
<td>PostgreSQL</td>
</tr>
<tr>
<td>PostgreSQL 11.0</td>
<td>PostgreSQL11_0</td>
<td>PostgreSQL</td>
</tr>
<tr>
<td>MySQL 4</td>
<td>MySql4</td>
<td>MySql</td>
</tr>
<tr>
<td>MySQL 5</td>
<td>MySql5</td>
<td>MySql, MariaDB</td>
</tr>
<tr>
<td>Oracle</td>
<td>Oracle</td>
<td></td>
</tr>
<tr>
<td>Oracle (managed ADO.NET)</td>
<td>OracleManaged</td>
<td>Oracle</td>
</tr>
<tr>
<td>Oracle (DotConnect ADO.NET)</td>
<td>OracleDotConnect</td>
<td>Oracle</td>
</tr>
<tr>
<td>Microsoft JET Engine (Access)</td>
<td>Jet</td>
<td></td>
</tr>
<tr>
<td>SQLite</td>
<td>Sqlite</td>
<td></td>
</tr>
<tr>
<td>Firebird</td>
<td>Firebird</td>
<td></td>
</tr>
<tr>
<td>Amazon Redshift</td>
<td>Redshift</td>
<td></td>
</tr>
<tr>
<td>SAP Hana</td>
<td>Hana</td>
<td></td>
</tr>
<tr>
<td><del>SAP SQL Anywhere</del><sup>(4)</sup></td>
<td><del>SqlAnywhere16</del></td>
<td><del>SqlAnywhere</del></td>
</tr>
<tr>
<td>DB2</td>
<td>DB2</td>
<td></td>
</tr>
<tr>
<td>DB2 iSeries</td>
<td>DB2 iSeries</td>
<td>DB2</td>
</tr>
</tbody>
</table>
<ul>
<li><sup>(1)</sup> All integration tests ran without error against an SQL Server 2019 using the SqlServer2016 dialect.</li>
<li><sup>(2)</sup> All integration tests ran without error against an SQL Server 2017 using the SqlServer2016 dialect.</li>
<li><sup>(3)</sup> Support for Microsoft SQL Server Compact Edition is being dropped due to Microsoft end-of-life support date passing.</li>
<li><sup>(4)</sup> Support for SAP SQL Anywhere is being dropped due to SAP not supporting a .NET Core / .NET 5 database driver.</li>
</ul>
<h2 id="how-can-i-run-migrations-safely-from-multiple-application-servers">How can I run migrations safely from multiple application servers?</h2>
<p>Many server-side applications are load balanced and run multiple instances of the same application simultaneously from multiple web servers. In such a scenarios, if you choose to run migrations in-process (as opposed to an external migration runner), then there is an added risk of multiple processes trying to run migrations at the same time.</p>
<p>FluentMigrator does not automatically handle this scenario because the default transactional behavior is not enough to guarantee that only a single process can be running migrations at any given time. There are, however, some workarounds.</p>
<h3 id="database-dependent-application-locking">Database-Dependent Application Locking</h3>
<p>This style of solution depends upon MaintenanceMigrations. Two Maintenance Migrations are created: One with <code>BeforeAll</code> to atomically acquire a lock, and one <code>AfterAll</code> stage to release the lock.</p>
<p>This example is for <strong>SQL Server 2008 and above</strong> and uses <a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-getapplock-transact-sql"><code>sp_getapplock</code></a> to aquire a named lock before all migrations are run, and <a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-releaseapplock-transact-sql"><code>sp_releaseapplock</code></a> to release the lock after all migrations are finished.</p>
<pre><code class="lang-c#">[Maintenance(MigrationStage.BeforeAll, TransactionBehavior.None)]
public class DbMigrationLockBefore : Migration
{
    public override void Down()
    {
        throw new NotImplementedException(&quot;Down migrations are not supported for sp_getapplock&quot;);
    }

    public override void Up()
    {
        Execute.Sql(@&quot;
            DECLARE @result INT
            EXEC @result = sp_getapplock 'MyApp', 'Exclusive', 'Session'

            IF @result &lt; 0
            BEGIN
                DECLARE @msg NVARCHAR(1000) = 'Received error code ' + CAST(@result AS VARCHAR(10)) + ' from sp_getapplock during migrations';
                THROW 99999, @msg, 1;
            END
        &quot;);
    }
}

[Maintenance(MigrationStage.AfterAll, TransactionBehavior.None)]
public class DbMigrationUnlockAfter : Migration
{
    public override void Down()
    {
        throw new NotImplementedException(&quot;Down migrations are not supported for sp_releaseapplock&quot;);
    }

    public override void Up()
    {
        Execute.Sql(&quot;EXEC sp_releaseapplock 'MyApp', 'Session'&quot;);
    }
}
</code></pre>
<p>In the above SQL Server example, we need to use <code>TransactionBehavior.None</code> on the Maintenance Migration while specifying the <code>@LockOwner</code> parameter to <code>Session</code>, which means that the locking behavior applies to the entire Session rather than a single transaction.</p>
<p>While the above is specific to SQL Server, similar concepts may available in other database providers.</p>
<ul>
<li>PostgreSQL has <a href="https://www.postgresql.org/docs/10/explicit-locking.html#ADVISORY-LOCKS">Advisory Locks</a></li>
<li>SQL Anywhere has <a href="http://infocenter.sybase.com/help/topic/com.sybase.help.sqlanywhere.12.0.1/dbusage/transact-s-3443172.html">Schema Locks</a></li>
<li>Oracle has <a href="https://docs.oracle.com/cd/A91202_01/901_doc/appdev.901/a89852/dbms_l2a.htm">DBMS_LOCK.ALLOCATE_UNIQUE</a></li>
<li>DB2 has <a href="https://www.ibm.com/support/knowledgecenter/en/SSEPEK_11.0.0/perf/src/tpc/db2z_lockmode.html">LOCK TABLESPACE</a> (with the caveat that every table in your migration is in the same tablespace)</li>
</ul>
<h3 id="external-distributed-lock">External Distributed Lock</h3>
<p>If your database doesn't provide a means of acquiring an exclusive lock for migrations, it is still possible to achieve this functionality by using an external service for acquiring a distributed lock.</p>
<p>For example, Redis provides a way to perform <a href="https://redis.io/topics/distlock">Distributed locks</a> so that different processes can operate on a shared resource in a mutually exclusive way. This scenario can be baked into a <code>BeforeAll</code>/<code>AfterAll</code> pair of Maintenance Migrations, as demonstrated above, to acquire an exclusive lock for the duration of the migration running.</p>
<p>As an alternative to Maintenance Migrations, which are by necessity specified in different classes, you could simply wrap the <code>MigrateUp()</code> call in code that acquires and releases the lock. Consider this pseudo-code which relies on <a href="https://github.com/samcook/RedLock.net">RedLock.net</a>:</p>
<pre><code class="lang-c#">async RunMigrationsWithDistributedLock(IMigrationRunner runner)
{
    var resource = &quot;my-app-migrations&quot;;
    var expiry = TimeSpan.FromMinutes(5);

    using (var redLock = await redlockFactory.CreateLockAsync(resource, expiry)) // there are also non async Create() methods
    {
        // make sure we got the lock
        if (redLock.IsAcquired)
        {
            runner.MigrateUp();
        }
    }
    // the lock is automatically released at the end of the using block
}
</code></pre>
<h3 id="how-can-i-execute-a-stored-procedure-using-oracle">How can I execute a stored procedure using Oracle?</h3>
<p>If you get <code>ORA-00900: Invalid SQL Statement</code> when executing a stored procedure, then chances are you need to wrap your stored procedure in a PLSQL block:</p>
<pre><code class="lang-c#">  Execute.Sql(&quot;DBMS_UTILITY.EXEC_DDL_STATEMENT('Create Index Member_AddrId On Member(AddrId)');&quot;);
</code></pre>
<p>becomes:</p>
<pre><code class="lang-c#">  Execute.Sql(@&quot;
BEGIN
  DBMS_UTILITY.EXEC_DDL_STATEMENT('Create Index Member_AddrId On Member(AddrId)');
END;&quot;);
</code></pre>
<h2 id="how-do-i-get-the-name-of-a-sql-server-database">How do I get the name of a SQL Server database?</h2>
<p>Not all databases have a &quot;name&quot;. Writing migrations that use a name therefore cannot be truly database-agnostic. That said, the following will show an example of getting the name so that you can perform an <code>ALTER DATABASE</code> command.  Note that to <code>ALTER DATABASE [YourDatabaseName]</code>, you need to switch to the <code>[master]</code> database first via <code>USE [master]</code>.  Then, since FluentMigrator does not call <code>sp_reset_connection</code>, you need to switch back to the database being migrated.  If you do not, the ensuing migrations will be run in the wrong database!</p>
<p>In the below example, we show how to enter a SQL Server database into single-user mode, in order to perform some maintenace tasks.</p>
<p>Use dynamic SQL:</p>
<pre><code class="lang-csharp">    public class EnterDatabaseSingleUserModeState : Migration
    {
        public override void Up()
        {
            /* Before you set the database to SINGLE_USER, verify that
            the AUTO_UPDATE_STATISTICS_ASYNC option is set to OFF. When
            this option is set to ON, the background thread that is
            used to update statistics takes a connection against the
            database, and you will be unable to access the database in
            single-user mode. For more information, see
            ALTER DATABASE SET Options (Transact-SQL). */
            this.Execute.Sql(@&quot;
              DECLARE @DbName sysname = DB_NAME();
              DECLARE @SqlCommand NVARCHAR(MAX) = '
USE [master];
SET DEADLOCK_PRIORITY 10;
DECLARE @AutoUpdateStatisticsAsync BIT = CAST(0 AS BIT);
IF EXISTS (
    SELECT NULL
    FROM sys.databases WHERE name = @DbName AND is_auto_update_stats_async_on = CAST(1 AS BIT)
)
BEGIN
    ALTER DATABASE [' + @DbName + '] 
    SET AUTO_UPDATE_STATISTICS_ASYNC OFF;
    SET @AutoUpdateStatisticsAsync = CAST(1 AS BIT);
END;
ALTER DATABASE [' + @DbName + ']' + ' SET SINGLE_USER WITH ROLLBACK IMMEDIATE;

-- Here is where you put your administrative commands.

IF (@AutoUpdateStatisticsAsync = 1)
BEGIN
    ALTER DATABASE [' + @DbName + '] 
    SET AUTO_UPDATE_STATISTICS_ASYNC ON;
END;
';
              
              EXEC(@SqlCommand);
              SET @SqlCommand NVARCHAR(MAX) = 'USE [' + @DbName + ']';
              EXEC(@SqlCommand);
            &quot;);
    }
</code></pre>
<h2 id="certificate-error-for-sql-connection">Certificate error for SQL Connection</h2>
<p>Since the use of <code>Microsoft.Data.SqlClient</code> version <code>4.0.0</code> connections are encrypted by default in .NET. You might start getting the exception: <code>A connection was successfully established with the server, but then an error occurred during the login process. (provider: SSL Provider, error: 0 - The certificate chain was issued by an authority that is not trusted.)</code>. If fixing a valid certificate isn't a feasable path, you can always disable the encryption by adding <code>Encrypt=False</code> to the connection string. Then the connection won't be encryptet, and thus no certificate needed. As a note; you can also add <code>TrustServerCertificate=True</code> to the connection string, if you have a self-signed certificate or similar. But it's probably a better idea to fix a real certificate, or skip encryption all together.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/fluentmigrator/documentation/blob/master/articles/faq.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <table border='0'><tr><td><span>Copyright © 2018 Fluent Migrator Project<br>Generated by <strong>DocFX</strong></span></td><td><a rel='license' href='http://creativecommons.org/licenses/by-sa/4.0/'><img alt='Creative Commons License' style='border-width:0' src='https://i.creativecommons.org/l/by-sa/4.0/88x31.png'></a><br><span xmlns:dct='http://purl.org/dc/terms/' property='dct:title'>FluentMigrator Documentation</span> by <a xmlns:cc='http://creativecommons.org/ns#' href='https://fluentmigrator.github.io' property='cc:attributionName' rel='cc:attributionURL'>FluentMigrator Project</a> is licensed under a <a rel='license' href='http://creativecommons.org/licenses/by-sa/4.0/'>Creative Commons Attribution-ShareAlike 4.0 International License</a>.</td></tr></table>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
